parameters:
  - name: environmentType
    type: string
    values:
      - Dev
      - QA
      - Prod
  - name: dependsOn
    type: string

stages:
- stage: deployStage${{ parameters.environmentType }}
  displayName: ${{ parameters.environmentType }}
  dependsOn: ${{ parameters.dependsOn }}
  variables:
    - template: config.variables.yml
  jobs:
    - job: stagingSlotJob
      displayName: Staging Slot
      steps:
        - script: |
            echo 'download artifact'
          displayName: Download Artifact
        - script: |
            echo 'webApp deploy staging'
            echo azureSubscription-${{ variables.azureSubscription }}
            echo appName-${{ variables.appName }}
          displayName: Deploy Staging

    - template: smokeTest.job.yml
      dependsOn: stagingSlotJob
      parameters:
        type: Staging
        urls: urlsValue-staging
        appName: ${{ variables.appName }}

    - job: productionSlotJob
      displayName: Production Slot
      dependsOn: smokeTestStaging
      steps:
        - script: |
            echo 'swapSlots production'
            echo resourceGroupName-${{ variables.resourceGroupName }}
          displayName: SwapSlots Production

    - template: smokeTest.job.yml
      dependsOn: productionSlotJob
      parameters:
        type: Prod
        urls: urlsValue-prod
        appName: ${{ variables.appName }}
