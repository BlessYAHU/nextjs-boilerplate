parameters:
  - name: azureSubscription
    type: string
  - name: environmentType
    type: string
    values:
      - Dev
      - QA
      - Prod
  - name: appName
    type: string
  - name: resourceGroupName
    type: string
  - name: dependsOn
    type: string

#variables:
#  - stageName: deployStage${{ parameters.environmentType }}

stages:
- stage: deployStage${{ parameters.environmentType }}
  displayName: ${{ parameters.environmentType }}
  dependsOn: ${{ parameters.dependsOn }}
  jobs:
    - job: stagingSlotJob
      displayName: Staging Slot
      steps:
        - script: |
            echo 'download artifact'
          displayName: Download Artifact
        - script: |
            echo 'webApp deploy staging'
            echo azureSubscription-${{ parameters.azureSubscription }}
            echo appName-${{ parameters.appName }}
          displayName: Deploy Staging

    - template: smokeTest.job.yml
      parameters:
        type: Staging
        urls: urlsValue-staging
        appName: ${{ parameters.appName }}

    - job: productionSlotJob
      displayName: Production Slot
      steps:
        - script: |
            echo 'swapSlots production'
            echo resourceGroupName-${{ parameters.resourceGroupName }}
          displayName: SwapSlots Production

    - template: smokeTest.job.yml
      parameters:
        type: Prod
        urls: urlsValue-prod
        appName: ${{ parameters.appName }}
